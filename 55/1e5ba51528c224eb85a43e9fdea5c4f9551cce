---------------------------------------------------------------------------

by mpdude at 2017-06-14T20:59:48Z

Rebased to resolve conflicts after #23123 merged into 2.7
