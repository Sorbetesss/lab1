---------------------------------------------------------------------------

by carsonbot at 2024-04-07T14:02:06Z

Hey!

I see that this is your first PR. That is great! Welcome!

Symfony has a [contribution guide](https://symfony.com/doc/current/contributing/index.html) which I suggest you to read.

In short:
- Always add tests
- Keep backward compatibility (see https://symfony.com/bc).
- Bug fixes must be submitted against the lowest maintained branch where they apply (see https://symfony.com/releases)
- Features and deprecations must be submitted against the 7.1 branch.

Review the GitHub status checks of your pull request and try to solve the reported issues. If some tests are failing, try to see if they are failing because of this change.

When two Symfony core team members approve this change, it will be merged and you will become an official Symfony contributor!
If this PR is merged in a lower version branch, it will be merged up to all maintained branches within a few days.

I am going to sit back now and wait for the reviews.

Cheers!

Carsonbot

---------------------------------------------------------------------------

by nicolas-grekas at 2024-04-08T08:24:38Z

Thanks for investigating and for the reproducer.
When I run the code you shared, I have everything green:
✅ HTTP/1 default behavior
✅ HTTP/2 default behavior
✅ HTTP/1 suppressed header
✅ HTTP/2 suppressed header

Could this be related to some curl bug? Which exact version of curl and php do you have ? (`php --ri curl && php -v`)

Mine:
 - curl 7.81.0
 - php 8.3.4

---------------------------------------------------------------------------

by michaelhue at 2024-04-08T08:48:53Z

Hey Nicolas, that's interesting!

- curl: `8.7.1`
- PHP: `8.3.4`

I checked the `curl` issues and found some posts that may be related:

- https://github.com/curl/curl/issues/13229
- https://github.com/curl/curl/pull/13257

While I'm not sure this is the bug I'm experiencing, there is a relevant quote:
> Applications are encouraged to not force "chunked", but rather set length information for a POST. By setting -1, curl will auto-select chunked on HTTP/1.1 and work properly on other HTTP versions.

That is the behavior this pull request would address.

---

I just checked the servers where I first experienced https://github.com/symfony/symfony/issues/54491 and they are also on curl `8.7.1`.
